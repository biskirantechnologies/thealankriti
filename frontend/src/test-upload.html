<!DOCTYPE html>
<html>
<head>
    <title>Image Upload Test</title>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
</head>
<body>
    <h1>Image Upload Test</h1>
    <button onclick="loginFirst()">1. Login as Admin</button>
    <br><br>
    <input type="file" id="imageInput" accept="image/*" multiple>
    <button onclick="testImageUpload()">2. Upload Selected Images</button>
    <div id="output"></div>
    <div id="preview"></div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        let authToken = '';

        function log(message) {
            const output = document.getElementById('output');
            output.innerHTML += '<p>' + new Date().toLocaleTimeString() + ': ' + message + '</p>';
        }

        async function loginFirst() {
            try {
                log('Attempting admin login...');
                const response = await fetch(`${API_BASE}/auth/admin-login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'bewithu.aj@gmail.com',
                        password: 'admin123'
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    Cookies.set('token', authToken);
                    log('✅ Login successful!');
                } else {
                    log('❌ Login failed: ' + data.message);
                }
            } catch (error) {
                log('❌ Login error: ' + error.message);
            }
        }

        async function testImageUpload() {
            if (!authToken) {
                log('❌ Please login first!');
                return;
            }

            const fileInput = document.getElementById('imageInput');
            if (fileInput.files.length === 0) {
                log('❌ Please select at least one image!');
                return;
            }

            try {
                log('Uploading images...');
                const preview = document.getElementById('preview');
                preview.innerHTML = '';

                for (let i = 0; i < fileInput.files.length; i++) {
                    const file = fileInput.files[i];
                    const formData = new FormData();
                    formData.append('image', file);

                    const response = await fetch(`${API_BASE}/admin/upload-image`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: formData
                    });

                    const data = await response.json();
                    
                    if (response.ok) {
                        log(`✅ Image ${i + 1} uploaded: ${data.imageUrl}`);
                        
                        // Show preview
                        const img = document.createElement('img');
                        img.src = `http://localhost:3001${data.imageUrl}`;
                        img.style.width = '100px';
                        img.style.height = '100px';
                        img.style.objectFit = 'cover';
                        img.style.margin = '5px';
                        img.style.border = '1px solid #ccc';
                        preview.appendChild(img);
                    } else {
                        log(`❌ Image ${i + 1} upload failed: ${data.message}`);
                    }
                }
            } catch (error) {
                log('❌ Upload error: ' + error.message);
            }
        }
    </script>
</body>
</html>
